---
title: "Assignment 1"
author: "Christina Lin"
date: "9/17/2021"
output: github_document
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Step 1. Retrieving data and checking for missing values

Reading 2004 and 2019 Data
```{r}
library(data.table)
library(tidyverse)

if (!file.exists("../2004_data"))
  download.file(
    url = "https://www3.epa.gov/cgi-bin/broker?_service=data&_server=134.67.99.91&_port=4090&_sessionid=sKkgCqL/R52&_PROGRAM=dataprog.ad_viz_plotval_getdata.sas",
    destfile = "2004_data",
    method   = "libcurl",
    timeout  = 60
    )
pm2004 <- data.table::fread("2004_data")


if (!file.exists("../2019_data"))
  download.file(
    url = "https://www3.epa.gov/cgi-bin/broker?_service=data&_server=134.67.99.91&_port=4090&_sessionid=epxagqL/R52&_PROGRAM=dataprog.ad_viz_plotval_getdata.sas",
    destfile = "2019_data",
    method   = "libcurl",
    timeout  = 60
    )
pm2019 <- data.table::fread("2019_data")

```

Checking dimensions, headers, footers, variables names and variable types

```{r}
# For 2004 Dataset
dim(pm2004)
head(pm2004)
tail(pm2004)
str(pm2004)


# For 2019 Dataset
dim(pm2019)
head(pm2019)
tail(pm2019)
str(pm2019)

```

Checking for issues in key variables
```{r}
summary(pm2004$`Daily Mean PM2.5 Concentration`)
summary(pm2004$SITE_LATITUDE)
summary(pm2004$SITE_LONGITUDE)
mean(is.na(pm2004$`Daily Mean PM2.5 Concentration`))
mean(is.na(pm2004$SITE_LATITUDE))
mean(is.na(pm2004$SITE_LONGITUDE))


summary(pm2019$`Daily Mean PM2.5 Concentration`)
summary(pm2019$SITE_LATITUDE)
summary(pm2019$SITE_LONGITUDE)
mean(is.na(pm2019$`Daily Mean PM2.5 Concentration`))
mean(is.na(pm2019$SITE_LATITUDE))
mean(is.na(pm2019$SITE_LONGITUDE))

```



In 2004, there were 19233 observations total. In 2019, there were 53086 observations total. There are no missing values (i.e. "NA"s) for daily mean 2.5 concentration, latitude, and longitude for both the 2004 and 2019 datasets. Upon examining the minimum and maximum values for these variables, there does not appear to be any "9999" in place of missing values either. Thus, the datasets looks ready for analysis. 



#Step 2: Combining the two data sets into one data frame

```{r}
library(dplyr)
pm <- rbind(pm2004, pm2019)

#Adding year as a new column and simplifying names of key variables 
pm <- mutate(pm, year = factor(rep(c(2004, 2019), c(nrow(pm2004), nrow(pm2019))))) %>%
  rename(dPM ="Daily Mean PM2.5 Concentration") %>%
  rename(lat = SITE_LATITUDE) %>%
  rename(lon = SITE_LONGITUDE)

str(pm)

```



#Step 3: Create a basic map in leaflet() that shows the locations of the sites

```{r}

library(leaflet)

pal <- colorFactor(palette=c('red','blue'), domain=pm$year)

leaflet(pm) %>%
  addProviderTiles('CartoDB.Positron') %>%
  addCircles(
    lat = ~lat, lng=~lon,
    color = ~pal(year),
    opacity = 1, fillOpacity = 1, radius = 500
    ) %>%
  addLegend('bottomleft', pal=pal, values=pm$year,
          title='Year', opacity=1)

```


Observations: The sites in 2004 were mainly at the north and south ends of California while in 2019, the sites are more evently scattered around the state. 


#Step 4: Check for any missing or implausible values of PM in the combined dataset

```{r}
summary(pm)
```

Observations: There are PM2.5 values that are negative, which does not seem plausible since these values represent a concentration. 

```{r}
(dPM < 0)
```

